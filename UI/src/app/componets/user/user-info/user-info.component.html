<div class="page-container">
  <!-- Page Header -->
  <div class="page-header mb-4">
    <div class="header-content">
      <h1 class="page-title mb-1">
        <i class="bi bi-person-circle me-2"></i>User Information
      </h1>
      <p class="page-subtitle">Manage and update user profile details</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container-fluid">
    <form #userForm="ngForm" [ngClass]="{'was-validated': formSubmitted}" novalidate class="app-form">
      <!-- Accordions Container -->
      <div class="accordion accordion-modern" id="accPatientBaseInfo">
    <!-- Personal Information Section -->
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#accPatientPersonalInfo"
          aria-expanded="true" aria-controls="accPatientPersonalInfo">
          <i class="bi bi-person-check-fill me-2"></i>
          <span class="accordion-title">Personal Information</span>
          <span class="accordion-badge badge bg-primary ms-auto">5</span>
        </button>
      </h2>
      <div id="accPatientPersonalInfo" class="accordion-collapse collapse show">
        <div class="accordion-body">
          <div class="form-section">
            <!-- Row 1: First Name & Last Name -->
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtFirstName" class="form-label">
                    <i class="bi bi-person me-1"></i>First Name
                  </label>
                  <input type="text" id="txtFirstName" name="FirstName" class="form-control form-control-lg" 
                    [ngModel]="user?.FirstName" (ngModelChange)="user && (user.FirstName = $event)" 
                    minlength="3" maxlength="50" required placeholder="Enter first name"> 
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please enter a first name (3-50 characters).
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtLastName" class="form-label">
                    <i class="bi bi-person me-1"></i>Last Name
                  </label>
                  <input type="text" id="txtLastName" name="LastName" class="form-control form-control-lg" 
                    [ngModel]="user?.LastName" (ngModelChange)="user && (user.LastName = $event)" 
                    minlength="3" maxlength="50" required placeholder="Enter last name">
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please enter a last name (3-50 characters).
                  </div>
                </div>
              </div>
            </div>

            <!-- Row 2: Age & Gender -->
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtAge" class="form-label">
                    <i class="bi bi-calendar me-1"></i>Age
                  </label>
                  <input type="number" id="txtAge" name="Age" class="form-control form-control-lg" 
                    [ngModel]="user?.Age" (ngModelChange)="user && (user.Age = $event)" 
                    min="1" max="150" required placeholder="Enter age">
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please enter a valid age (1-150).
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-label">
                    <i class="bi bi-people me-1"></i>Gender
                  </label>
                  <div class="gender-group">
                    <div class="form-check form-check-inline">
                      <input type="radio" id="rdGenderMale" name="gender" class="form-check-input" value="1" 
                        [checked]="user?.Gender === 1" (change)="user && (user.Gender = 1)" required>
                      <label class="form-check-label" for="rdGenderMale">Male</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input type="radio" id="rdGenderFemale" name="gender" class="form-check-input" value="2" 
                        [checked]="user?.Gender === 2" (change)="user && (user.Gender = 2)" required>
                      <label class="form-check-label" for="rdGenderFemale">Female</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input type="radio" id="rdGenderOther" name="gender" class="form-check-input" value="3" 
                        [checked]="user?.Gender === 3" (change)="user && (user.Gender = 3)" required>
                      <label class="form-check-label" for="rdGenderOther">Other</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input type="radio" id="rdGenderPreferNotToSay" name="gender" class="form-check-input" value="4" 
                        [checked]="user?.Gender === 4" (change)="user && (user.Gender = 4)" required>
                      <label class="form-check-label" for="rdGenderPreferNotToSay">Prefer Not</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Row 3: User Name & Password -->
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtUserName" class="form-label">
                    <i class="bi bi-at me-1"></i>User Name
                  </label>
                  <input type="text" id="txtUserName" name="UserName" class="form-control form-control-lg" 
                    [ngModel]="user?.UserName" (ngModelChange)="user && (user.UserName = $event)" 
                    minlength="3" maxlength="50" required placeholder="Enter username"> 
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please enter a valid user name (3-50 characters).
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtPassword" class="form-label">
                    <i class="bi bi-lock me-1"></i>Password
                  </label>
                  <input type="password" id="txtPassword" name="Password" class="form-control form-control-lg" 
                    [ngModel]="user?.Password" (ngModelChange)="user && (user.Password = $event)" 
                    minlength="3" maxlength="50" required placeholder="Enter password">
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please enter a valid password (3-50 characters).
                  </div>
                </div>
              </div>
            </div>

            <!-- Row 4: User Type -->
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="cbUserType" class="form-label">
                    <i class="bi bi-briefcase me-1"></i>User Type
                  </label>
                  <select id="cbUserType" name="UserType" class="form-select form-select-lg" 
                    [ngModel]="user?.UserType" (ngModelChange)="onUserTypeChange($event)" required>
                    <option value="">-- Select User Type --</option>
                    <option value="1">Patient</option>
                    <option value="2">Doctor</option>
                    <option value="5">Administrator</option>
                  </select>
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please select a user type.
                  </div>
                </div>
              </div>
            </div>

            <!-- Doctor Specific Fields -->
            @if(user?.UserType === 2) {
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtDesignation" class="form-label">
                    <i class="bi bi-badge-md me-1"></i>Designation
                  </label>
                  <input type="text" id="txtDesignation" name="Designation" class="form-control form-control-lg" 
                    [ngModel]="user?.Designation" (ngModelChange)="user && (user.Designation = $event)" 
                    placeholder="Enter designation"> 
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please fill out this field.
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtSpecialization" class="form-label">
                    <i class="bi bi-stethoscope me-1"></i>Specialization
                  </label>
                  <input type="text" id="txtSpecialization" name="Specialization" class="form-control form-control-lg" 
                    [ngModel]="user?.Specialization" (ngModelChange)="user && (user.Specialization = $event)" 
                    placeholder="Enter specialization"> 
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please fill out this field.
                  </div>
                </div>
              </div>
            </div>
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtLicenseNumber" class="form-label">
                    <i class="bi bi-card-text me-1"></i>License Number
                  </label>
                  <input type="text" id="txtLicenseNumber" name="LicenseNumber" class="form-control form-control-lg" 
                    [ngModel]="user?.LicenseNumber" (ngModelChange)="user && (user.LicenseNumber = $event)" 
                    placeholder="Enter license number"> 
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please fill out this field.
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtLicenseExpiryDate" class="form-label">
                    <i class="bi bi-calendar-event me-1"></i>License Expiry Date
                  </label>
                  <input type="date" id="txtLicenseExpiryDate" name="LicenseExpiryDate" class="form-control form-control-lg"
                    [ngModel]="user?.LicenseExpiryDate" (ngModelChange)="user && (user.LicenseExpiryDate = $event)"> 
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please fill out this field.
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Address Section -->
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button" type="button" data-bs-toggle="collapse"
          data-bs-target="#accPatientAddress" aria-expanded="false" aria-controls="accPatientAddress">
          <i class="bi bi-house-door me-2"></i>
          <span class="accordion-title">Address Information</span>
          <span class="accordion-badge badge bg-info ms-auto">2</span>
        </button>
      </h2>
      <div id="accPatientAddress" class="accordion-collapse collapse">
        <div class="accordion-body">
          <div class="form-section">
            <!-- Address Tabs -->
            <ul class="nav nav-pills nav-justified address-tabs mb-3" id="tbAddress" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="tbPermanantAddress-tab" data-bs-toggle="tab"
                  data-bs-target="#tbPermanantAddress" type="button" role="tab" aria-controls="tbPermanantAddress"
                  aria-selected="true">
                  <i class="bi bi-pin-map me-1"></i>Permanent Address
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="tbCorespondenceAddress-tab" data-bs-toggle="tab"
                  data-bs-target="#tbCorespondenceAddress" type="button" role="tab" aria-controls="tbCorespondenceAddress"
                  aria-selected="false">
                  <i class="bi bi-envelope me-1"></i>Correspondence Address
                </button>
              </li>
            </ul>
            <div class="tab-content" id="nav-tabContent">
              <!-- Permanent Address Tab -->
              <div class="tab-pane fade show active" id="tbPermanantAddress" role="tabpanel"
                aria-labelledby="tbPermanantAddress-tab">
                <div class="row g-3 mb-3">
                  <div class="col-12">
                    <div class="form-group">
                      <label for="txtPermAddress1" class="form-label">
                        <i class="bi bi-street-view me-1"></i>Address Line 1
                      </label>
                      <input type="text" id="txtPermAddress1" name="PermAddress1" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.PermAddress1" (ngModelChange)="user.Address && (user.Address.PermAddress1 = $event)"
                        placeholder="Enter address line 1">
                    </div>
                  </div>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-12">
                    <div class="form-group">
                      <label for="txtPermAddress2" class="form-label">
                        <i class="bi bi-street-view me-1"></i>Address Line 2
                      </label>
                      <input type="text" id="txtPermAddress2" name="PermAddress2" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.PermAddress2" (ngModelChange)="user.Address && (user.Address.PermAddress2 = $event)"
                        placeholder="Enter address line 2">
                    </div>
                  </div>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="txtPermCity" class="form-label">
                        <i class="bi bi-geo-alt me-1"></i>City
                      </label>
                      <input type="text" id="txtPermCity" name="PermCity" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.PermCity" (ngModelChange)="user.Address && (user.Address.PermCity = $event)"
                        placeholder="Enter city">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="txtPermState" class="form-label">
                        <i class="bi bi-map me-1"></i>State
                      </label>
                      <input type="text" id="txtPermState" name="PermState" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.PermState" (ngModelChange)="user.Address && (user.Address.PermState = $event)"
                        placeholder="Enter state">
                    </div>
                  </div>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="txtPermCountry" class="form-label">
                        <i class="bi bi-globe me-1"></i>Country
                      </label>
                      <input type="text" id="txtPermCountry" name="PermCountry" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.PermCountry" (ngModelChange)="user.Address && (user.Address.PermCountry = $event)"
                        placeholder="Enter country">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="txtPermZipCode" class="form-label">
                        <i class="bi bi-mailbox me-1"></i>Zip Code
                      </label>
                      <input type="text" id="txtPermZipCode" name="PermZipCode" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.PermZipCode" (ngModelChange)="user.Address && (user.Address.PermZipCode = $event)"
                        placeholder="Enter zip code">
                    </div>
                  </div>
                </div>
              </div>
  
              <!-- Correspondence Address Tab -->
              <div class="tab-pane fade" id="tbCorespondenceAddress" role="tabpanel"
                aria-labelledby="tbCorespondenceAddress-tab">
                <div class="copy-address-btn mb-3">
                  <button type="button" class="btn btn-sm btn-outline-primary" (click)="CopyAddress()">
                    <i class="bi bi-files me-1"></i>Copy from Permanent Address
                  </button>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-12">
                    <div class="form-group">
                      <label for="txtCorsAddress1" class="form-label">
                        <i class="bi bi-street-view me-1"></i>Address Line 1
                      </label>
                      <input type="text" id="txtCorsAddress1" name="CorrAddress1" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.CorrAddress1" (ngModelChange)="user.Address && (user.Address.CorrAddress1 = $event)"
                        placeholder="Enter address line 1">
                    </div>
                  </div>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-12">
                    <div class="form-group">
                      <label for="txtCorsAddress2" class="form-label">
                        <i class="bi bi-street-view me-1"></i>Address Line 2
                      </label>
                      <input type="text" id="txtCorsAddress2" name="CorrAddress2" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.CorrAddress2" (ngModelChange)="user.Address && (user.Address.CorrAddress2 = $event)"
                        placeholder="Enter address line 2">
                    </div>
                  </div>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="txtCorsCity" class="form-label">
                        <i class="bi bi-geo-alt me-1"></i>City
                      </label>
                      <input type="text" id="txtCorsCity" name="CorrCity" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.CorrCity" (ngModelChange)="user.Address && (user.Address.CorrCity = $event)"
                        placeholder="Enter city">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="txtCorsState" class="form-label">
                        <i class="bi bi-map me-1"></i>State
                      </label>
                      <input type="text" id="txtCorsState" name="CorrState" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.CorrState" (ngModelChange)="user.Address && (user.Address.CorrState = $event)"
                        placeholder="Enter state">
                    </div>
                  </div>
                </div>
                <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="txtCorsCountry" class="form-label">
                        <i class="bi bi-globe me-1"></i>Country
                      </label>
                      <input type="text" id="txtCorsCountry" name="CorrCountry" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.CorrCountry" (ngModelChange)="user.Address && (user.Address.CorrCountry = $event)"
                        placeholder="Enter country">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="txtCorsZipCode" class="form-label">
                        <i class="bi bi-mailbox me-1"></i>Zip Code
                      </label>
                      <input type="text" id="txtCorsZipCode" name="CorrZipCode" class="form-control form-control-lg" 
                        [ngModel]="user.Address?.CorrZipCode" (ngModelChange)="user.Address && (user.Address.CorrZipCode = $event)"
                        placeholder="Enter zip code">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Section -->
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button" type="button" data-bs-toggle="collapse"
          data-bs-target="#accPatientContact" aria-expanded="false" aria-controls="accPatientContact">
          <i class="bi bi-telephone me-2"></i>
          <span class="accordion-title">Contact Information</span>
          <span class="accordion-badge badge bg-success ms-auto">2</span>
        </button>
      </h2>
      <div id="accPatientContact" class="accordion-collapse collapse">
        <div class="accordion-body">
          <div class="form-section">
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtPrimaryPhone" class="form-label">
                    <i class="bi bi-telephone me-1"></i>Primary Phone
                  </label>
                  <input type="text" id="txtPrimaryPhone" name="PrimaryPhone" class="form-control form-control-lg" 
                    [ngModel]="user.Contact?.PrimaryPhone" (ngModelChange)="user.Contact && (user.Contact.PrimaryPhone = $event)" 
                    required placeholder="Enter primary phone">
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please provide a primary phone.
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtSecondaryPhone" class="form-label">
                    <i class="bi bi-telephone me-1"></i>Secondary Phone
                  </label>
                  <input type="text" id="txtSecondaryPhone" name="SecondaryPhone" class="form-control form-control-lg" 
                    [ngModel]="user.Contact?.SecondaryPhone" (ngModelChange)="user.Contact && (user.Contact.SecondaryPhone = $event)"
                    placeholder="Enter secondary phone">
                </div>
              </div>
            </div>
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtPrimaryEmail" class="form-label">
                    <i class="bi bi-envelope me-1"></i>Primary Email
                  </label>
                  <input type="email" id="txtPrimaryEmail" name="PrimaryEmail" class="form-control form-control-lg" 
                    [ngModel]="user.Contact?.PrimaryEmail" (ngModelChange)="user.Contact && (user.Contact.PrimaryEmail = $event)" 
                    required placeholder="Enter primary email">
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please provide a valid primary email.
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtSecondaryEmail" class="form-label">
                    <i class="bi bi-envelope me-1"></i>Secondary Email
                  </label>
                  <input type="email" id="txtSecondaryEmail" name="SecondaryEmail" class="form-control form-control-lg" 
                    [ngModel]="user.Contact?.SecondaryEmail" (ngModelChange)="user.Contact && (user.Contact.SecondaryEmail = $event)"
                    placeholder="Enter secondary email">
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please provide a valid secondary email.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Emergency Contact Section -->
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button" type="button" data-bs-toggle="collapse"
          data-bs-target="#accPatientEmergency" aria-expanded="false" aria-controls="accPatientEmergency">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <span class="accordion-title">Emergency Contact</span>
          <span class="accordion-badge badge bg-warning ms-auto">4</span>
        </button>
      </h2>
      <div id="accPatientEmergency" class="accordion-collapse collapse">
        <div class="accordion-body">
          <div class="form-section">
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtEmemergencyContactName" class="form-label">
                    <i class="bi bi-person me-1"></i>Emergency Contact Name
                  </label>
                  <input type="text" id="txtEmemergencyContactName" name="RelativeName" class="form-control form-control-lg" 
                    [ngModel]="user.Contact?.RelativeName" (ngModelChange)="user.Contact && (user.Contact.RelativeName = $event)"
                    placeholder="Enter emergency contact name">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtEmemergencyContactRelation" class="form-label">
                    <i class="bi bi-share me-1"></i>Relationship
                  </label>
                  <input type="text" id="txtEmemergencyContactRelation" name="RelativeRealtion" class="form-control form-control-lg" 
                    [ngModel]="user.Contact?.RelativeRealtion" (ngModelChange)="user.Contact && (user.Contact.RelativeRealtion = $event)"
                    placeholder="e.g., Brother, Sister, Parent">
                </div>
              </div>
            </div>
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtEmemergencyContactPhone" class="form-label">
                    <i class="bi bi-telephone me-1"></i>Emergency Phone
                  </label>
                  <input type="text" id="txtEmemergencyContactPhone" name="RelativePhone" class="form-control form-control-lg" 
                    [ngModel]="user.Contact?.RelativePhone" (ngModelChange)="user.Contact && (user.Contact.RelativePhone = $event)"
                    placeholder="Enter emergency phone">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="txtEmemergencyContactEmail" class="form-label">
                    <i class="bi bi-envelope me-1"></i>Emergency Email
                  </label>
                  <input type="email" id="txtEmemergencyContactEmail" name="RelativeEmail" class="form-control form-control-lg" 
                    [ngModel]="user.Contact?.RelativeEmail" (ngModelChange)="user.Contact && (user.Contact.RelativeEmail = $event)"
                    placeholder="Enter emergency email">
                  <div class="invalid-feedback">
                    <i class="bi bi-exclamation-circle me-1"></i>Please provide a valid email address.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons-section mt-4 mb-4">
      <div class="button-group d-flex gap-3 flex-wrap">
        <button type="button" id="btnPatientSave" class="btn btn-lg btn-primary flex-grow-1" 
          (click)="SaveUserInformation()">
          <i class="bi bi-check-circle me-2"></i>Save Changes
        </button>
        <button type="button" id="btnPatientClear" class="btn btn-lg btn-outline-secondary flex-grow-1" 
          (click)="ClearUserInformation()">
          <i class="bi bi-arrow-counterclockwise me-2"></i>Clear Form
        </button>
        <button type="button" id="btnPatientDelete" class="btn btn-lg btn-outline-danger flex-grow-1" 
          (click)="DeleteUserInformation()">
          <i class="bi bi-trash me-2"></i>Delete User
        </button>
      </div>
    </div>
    </form>
  </div>
</div>